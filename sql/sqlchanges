create database cfpickem;

use cfpickem;

create table usuarios (
	id int(11) not null auto_increment,
    email varchar(255) not null,
    senha varchar(255) not null, 
    tipoUsuario int(1) not null,
    ativo boolean not null default 1,
    cadastro datetime not null,
    primary key (id));
    
alter table usuarios add column nome varchar(255) not null;
alter table usuarios add column sobrenome varchar(255) not null;
ALTER TABLE usuarios ADD CONSTRAINT UC_email UNIQUE (email);
alter table usuarios alter dataCadastro drop default;
alter table usuarios modify dataCadastro DATETIME;

alter table competicoes add column competicaoFinalizada TINYINT(1) NOT NULL DEFAULT 0;
alter table atletas add column profileAtleta VARCHAR(255);

alter table usuarios add column status int(1) not null default 1;

delete from usuarios where id = 2;
    
select * from usuarios;

insert into usuarios (email, senha, tipousuario, ativo, cadastro) values ('usuario@email.com', md5('user123'), 1, true, CURRENT_TIMESTAMP);

insert into usuarios (email, senha, tipousuario, ativo, cadastro) values ('bhsousa@gmail.com', md5('senha123'), 1, true, CURRENT_TIMESTAMP);
    
    
SET @sql = NULL;
SELECT
	GROUP_CONCAT(distinct
    CONCAT(
      'ifnull(SUM(case when nomeMetcon = ''',
      nomeMetcon,
      ''' then PONTOS end),0) AS `',
      nomeMetcon, '`'
    )
    ) INTO @sql
    FROM pontos_metcon;
    SET @sql = CONCAT('SELECT idUsuario, nomeUsuario, sobrenomeUsuario, ', @sql, ' FROM pontos_metcon GROUP BY idUsuario');
    PREPARE stmt FROM @sql;
EXECUTE stmt;
DEALLOCATE PREPARE stmt;


call classificacao_por_wod;